<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backend Connection Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #1a1a1a;
        color: #ffffff;
      }
      .test-item {
        background-color: #2d2d2d;
        padding: 15px;
        margin: 10px 0;
        border-radius: 6px;
        border-left: 4px solid #4caf50;
      }
      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 10px;
      }
      .pass {
        background-color: #4caf50;
      }
      .fail {
        background-color: #f44336;
      }
      .pending {
        background-color: #ff9800;
      }
      .loading {
        background-color: #2196f3;
      }
      .result {
        background-color: #1e1e1e;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
        font-family: monospace;
        font-size: 12px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>üîç Backend Connection Test</h1>

    <div class="test-item">
      <h3>1. Health Check</h3>
      <p>Testing backend health endpoint</p>
      <span id="health-status" class="status loading">TESTING...</span>
      <div id="health-result" class="result"></div>
    </div>

    <div class="test-item">
      <h3>2. MLB Activation</h3>
      <p>Testing MLB sport activation</p>
      <span id="mlb-status" class="status pending">WAITING...</span>
      <div id="mlb-result" class="result"></div>
    </div>

    <div class="test-item">
      <h3>3. MLB Props Fetch</h3>
      <p>Testing MLB props retrieval</p>
      <span id="props-status" class="status pending">WAITING...</span>
      <div id="props-result" class="result"></div>
    </div>

    <div class="test-item">
      <h3>4. Batch Predictions</h3>
      <p>Testing batch predictions endpoint</p>
      <span id="batch-status" class="status pending">WAITING...</span>
      <div id="batch-result" class="result"></div>
    </div>

    <script>
      const BACKEND_URL = "http://localhost:8000";

      async function testEndpoint(name, url, options = {}) {
        try {
          console.log(`Testing ${name}: ${url}`);
          const response = await fetch(url, {
            ...options,
            headers: {
              "Content-Type": "application/json",
              ...options.headers,
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.text();
          return { success: true, data, status: response.status };
        } catch (error) {
          return { success: false, error: error.message };
        }
      }

      async function runTests() {
        // Test 1: Health Check
        console.log("üîç Starting backend connection tests...");

        const healthResult = await testEndpoint(
          "Health Check",
          `${BACKEND_URL}/health`
        );
        updateTestResult("health", healthResult);

        if (!healthResult.success) {
          console.error("Health check failed, stopping tests");
          return;
        }

        // Test 2: MLB Activation
        const mlbResult = await testEndpoint(
          "MLB Activation",
          `${BACKEND_URL}/api/sports/activate/MLB`,
          {
            method: "POST",
          }
        );
        updateTestResult("mlb", mlbResult);

        // Test 3: MLB Props
        const propsResult = await testEndpoint(
          "MLB Props",
          `${BACKEND_URL}/mlb/odds-comparison/?market_type=playerprops`
        );
        updateTestResult("props", propsResult);

        // Test 4: Batch Predictions (if props available)
        if (propsResult.success) {
          try {
            const props = JSON.parse(propsResult.data);
            if (props && props.length > 0) {
              const sampleProps = props.slice(0, 5); // Test with first 5 props
              const batchResult = await testEndpoint(
                "Batch Predictions",
                `${BACKEND_URL}/api/unified/batch-predictions`,
                {
                  method: "POST",
                  body: JSON.stringify(sampleProps),
                }
              );
              updateTestResult("batch", batchResult);
            } else {
              updateTestResult("batch", {
                success: false,
                error: "No props available for batch test",
              });
            }
          } catch (e) {
            updateTestResult("batch", {
              success: false,
              error: "Failed to parse props data",
            });
          }
        } else {
          updateTestResult("batch", {
            success: false,
            error: "Skipped due to props fetch failure",
          });
        }

        console.log("‚úÖ All tests completed");
      }

      function updateTestResult(testName, result) {
        const statusEl = document.getElementById(`${testName}-status`);
        const resultEl = document.getElementById(`${testName}-result`);

        if (result.success) {
          statusEl.textContent = "PASS";
          statusEl.className = "status pass";
          resultEl.textContent = `‚úÖ Status: ${
            result.status
          }\n${result.data.substring(0, 500)}${
            result.data.length > 500 ? "..." : ""
          }`;
        } else {
          statusEl.textContent = "FAIL";
          statusEl.className = "status fail";
          resultEl.textContent = `‚ùå Error: ${result.error}`;
        }
      }

      // Start tests when page loads
      document.addEventListener("DOMContentLoaded", () => {
        console.log("üöÄ Backend Connection Test Started");
        runTests();
      });
    </script>
  </body>
</html>
