<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Card Expansion Test - Fixed</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #1e293b;
        color: white;
      }
      .test-result {
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        border: 2px solid;
      }
      .pass {
        background-color: #065f46;
        border-color: #10b981;
        color: #d1fae5;
      }
      .fail {
        background-color: #7f1d1d;
        border-color: #ef4444;
        color: #fecaca;
      }
      .pending {
        background-color: #374151;
        border-color: #9ca3af;
        color: #e5e7eb;
      }
      .instructions {
        background-color: #1e40af;
        color: #dbeafe;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .code {
        background-color: #374151;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>Card Expansion Fix Verification</h1>

    <div class="instructions">
      <h3>Test Instructions:</h3>
      <ol>
        <li>Make sure both backend and frontend servers are running</li>
        <li>
          Open the frontend in your browser: <code>http://localhost:8174</code>
        </li>
        <li>Navigate to the Props section</li>
        <li>Click on any prop card to expand it</li>
        <li>Verify that ONLY the clicked card expands</li>
        <li>Click on a different card</li>
        <li>
          Verify that the previous card collapses and the new card expands
        </li>
      </ol>
    </div>

    <h2>Fix Summary</h2>
    <div class="test-result pass">
      <strong>✅ Duplicate Component Definitions Removed</strong><br />
      Removed duplicate import statements and component definitions that were
      causing multiple instances of the expansion logic to run simultaneously.
    </div>

    <div class="test-result pass">
      <strong>✅ File Structure Cleaned</strong><br />
      Moved all imports to the top of the file and ensured proper component
      separation between HelpPopover and PropOllamaUnified.
    </div>

    <div class="test-result pass">
      <strong>✅ Single Card Expansion Logic Preserved</strong><br />
      The expandedRowKey state management and handleExpand function are now
      properly isolated to a single component instance.
    </div>

    <h2>Expected Behavior</h2>
    <div class="code">
      const handleExpand = () => { setExpandedRowKey(isExpanded ? null :
      proj.id); }; // Only one card should have isExpanded = true at any time
      const isExpanded = expandedRowKey === proj.id;
    </div>

    <h2>What Was Fixed</h2>
    <p>
      The issue was caused by duplicate code in the PropOllamaUnified.tsx file:
    </p>
    <ul>
      <li>
        <strong>Duplicate imports</strong> (lines 110-133) that created multiple
        React contexts
      </li>
      <li>
        <strong>Multiple instances</strong> of the same expansion logic running
        simultaneously
      </li>
      <li>
        <strong>Conflicting event handlers</strong> that would trigger expansion
        on all cards
      </li>
    </ul>

    <p>After the fix:</p>
    <ul>
      <li>✅ All imports moved to the top of the file</li>
      <li>✅ Single PropOllamaUnified component definition</li>
      <li>✅ One expandedRowKey state managing all card expansions</li>
      <li>✅ Proper click-outside collapse behavior preserved</li>
    </ul>

    <div class="test-result pending">
      <strong>⏳ Manual Testing Required</strong><br />
      Please test the card expansion behavior in the browser to confirm the fix
      is working correctly.
    </div>

    <h2>Files Modified</h2>
    <div class="code">
      frontend/src/components/PropOllamaUnified.tsx - Moved imports to top of
      file - Removed duplicate imports (lines 110-133) - Preserved single
      component definition - Fixed HelpPopover component closure
    </div>
  </body>
</html>
